<% if @article.featured?%>
  <div class='panel panel-primary'>
<% else %>
  <div class='panel panel-default'>
<% end %>

  <div class='panel-header clear article-title'>

    <% if @article.featured?%>
      <h3 class='bs-callout-primary'>
        <%= @article.title.html_safe %>
        <div class='label label-danger article-tag'>
          <%= @article.category.name %>
        </div>
      </h3>
    <% else %>
      <h3 class='bs-callout-default'>
        <%= @article.title.html_safe %>
        <div class='label label-default article-tag'>
          <%= @article.category.name %>
        </div>
      </h3>
    <% end %>

  </div>

  <hr>

  <div class='panel-body clear'>

  <p><%= @article.body.html_safe %></p>

  <div>
    <%= link_to gravatar_for(@article.user, size: 50), @article.user %>

    <span class='user'>
    <% if @article.user.admin? %>
      <%= link_to @article.user.name,
                  @article.user,
                  class: 'admin-user' %>
    <% else %>
      <% if @article.user.mod? %>
        <%= link_to @article.user.name,
                    @article.user,
                    class: 'mod-user' %>
      <% else %>
        <%= link_to @article.user.name,
                    @article.user %>
      <% end %>
    <% end %>
    </span>
  </div>

  <span class='article-time'>
    <li>Created: <%= @article.created_at %></li>
    <li>Updated: <%= @article.updated_at %></li>
  </span>

  <% if logged_in? && (current_user.admin? || current_user.mod? || current_user?(@article.user)) %>

    <div class='article-buttons'>

      <% if @article.approved? && !current_user.admin? && !current_user.mod? %>
        <span class='glyphicon glyphicon-eye-open btn-sm'></span>
      <% end %>

      <% if @article.featured? && !current_user.admin? && !current_user.mod? %>
        <span class='glyphicon glyphicon-star btn-sm'></span>
      <% end %>

      <% if current_user.admin? || current_user.mod? %>
        <% if @article.approved? %>
          <%= link_to '',
                      approve_article_path(@article),
                      method: :post,
                      data: { confirm: 'Unapprove this article?'},
                      class: 'btn btn-sm btn-primary
                              glyphicon glyphicon-eye-open' %>
        <% else %>
          <%= link_to '',
                      approve_article_path(@article),
                      method: :post,
                      data: { confirm: 'Approve this article?'},
                      class: 'btn btn-sm btn-default
                              glyphicon glyphicon-eye-close' %>
        <% end %>
      <% end %>

      <% if current_user.admin? || current_user.mod? %>
        <% if @article.featured? %>
          <%= link_to '',
                      feature_article_path(@article),
                      method: :post,
                      data: { confirm: 'Unfeature Article?'},
                      class: 'btn btn-sm btn-primary
                              glyphicon glyphicon-star' %>
          <% else %>
          <%= link_to '',
                      feature_article_path(@article),
                      method: :post,
                      data: { confirm: 'Feature Article?'},
                      class: 'btn btn-sm btn-default
                              glyphicon glyphicon-star-empty' %>
          <% end %>
      <% end %>

      <%= link_to '',
                  edit_article_path(@article),
                  class: 'btn btn-sm btn-warning
                          glyphicon glyphicon-pencil' %>

      <%= link_to '',
                  article_path(@article),
                  method: :delete,
                  data: { confirm: 'Delete Article??' },
                  class: 'btn btn-sm btn-danger
                          glyphicon glyphicon-remove'%>
    </div>

  <% end %>

  </div>

</div>

<div class='clear'>

  <h4><%= @article.comments.count %> Comments</h4>



  <div id='comment-form-fix'>
  </div>

  <div class='comment-container'>
    <%= comments_tree_for @article.comments.hash_tree %>
  </div>

  <% if logged_in? %>

  <div id='comment-form' class='row'>
    <%= render 'comments/article_comment_form' %>
  </div>

  <% end %>

</div>
